<!DOCTYPE html> <html lang="zh-CN" dir="ltr"> <head> <meta charset="UTF-8"> <!-- SEO --> <title>聊聊中后台前端应用：上下文的那些事儿</title> <meta property="og:title" content="聊聊中后台前端应用：上下文的那些事儿"> <meta name="description" content="终于可以单独写一篇文章来专门讲讲「上下文」相关的事情了。"> <meta property="og:description" content="终于可以单独写一篇文章来专门讲讲「上下文」相关的事情了。"> <meta name="keywords" content="软件工程,前端开发,前端工程"> <link rel="canonical" href="https://ourai.ws/posts/things-about-contexts-in-frontend-projects/"> <meta property="og:url" content="https://ourai.ws/posts/things-about-contexts-in-frontend-projects/"> <meta property="og:site_name" content="欧雷流"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "WebSite", "name" : "欧雷流", "url" : "https://ourai.ws" } </script> <meta property="og:image" content="https://ourai.ws/assets/posts/20210719/banner-10b49afd7da28bca9a53125f74e837c0e4a71dfb5da9baa15047408d50b16934.jpg"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2021-07-19T20:46:25+08:00"> <link rel="next" href="https://ourai.ws/posts/hello-world-from-anti-chaos/" title="说说「反混沌」：Hello, World!"> <link rel="prev" href="https://ourai.ws/posts/the-system-of-ui-components-in-frontend-projects/" title="聊聊中后台前端应用：业务中的组件体系"> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "NewsArticle", "headline": "聊聊中后台前端应用：上下文的那些事儿", "image": "/assets/posts/20210719/banner-10b49afd7da28bca9a53125f74e837c0e4a71dfb5da9baa15047408d50b16934.jpg", "datePublished": "2021-07-19T20:46:25+08:00", "description": "终于可以单独写一篇文章来专门讲讲「上下文」相关的事情了。" } </script> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "person", "name" : "欧雷流", "url" : "https://ourai.ws", "sameAs" : null } </script> <link rel="author" href="https://ourai.ws"> <!-- 页面渲染兼容性 --> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="renderer" content="webkit"> <meta name="viewport" content="width=device-width,initial-scale=1.0"> <!-- 订阅 --> <link type="application/atom+xml" rel="alternate" href="https://ourai.ws/atom.xml" title="欧雷流" /> <link type="application/rss+xml" rel="alternate" href="//ourai.ws/rss.xml" title="欧雷流"> <meta name="theme-color" content="#0871ab"> <link rel="icon" href="/assets/favicon-3e749ca030e3b71eb2662d947c789061d2da9e0f4ee5f3360cfa9ccbe053c8ba.ico"> <!-- 静态资源 --> <link type="text/css" rel="stylesheet" href="/assets/disqusjs.min-b077139304675330d06888b873bd88158951637593a3c17c4674bc855caf71af.css"> <link type="text/css" rel="stylesheet" href="/assets/global-b623500154e70cdef18bd463a0ef409c46da6d1ad99756cf169ddb354874bcbc.css"> <link type="text/css" rel="stylesheet" href="/assets/share-2811f36e337fef8021089414f657904b7e88db17d8ecade0688c8c3f5e632a5c.css"> <link type="text/css" rel="stylesheet" href="/assets/pages/post-d5f1244d69bfc31e3c7b73b16140ed8a09f0b5af40515abeae522bee80e92ec9.css"> <script type="text/javascript" src="/assets/statistic-ae0fea4509b55747b1bcc6318c58abf5817e03e26505a307f438b42f0c6783bc.js"></script> <script type="text/javascript" src="/assets/global-b3a80dd53acf48ad7228d6fd741dba15d3845cbc3783bdbbf7244151a45628aa.js"></script> <!--[if lt IE 9]> <script type="text/javascript" src="/assets/support_ie8-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js"></script> <![endif]--> </head> <body class="Page has-headerImage" itemscope itemtype="http://schema.org/WebPage"> <header class="Page-header"> <div class="navbar navbar-static-top"> <div class="container"> <div class="navbar-header"> <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse"> <span class="sr-only">切换导航</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a href="/" class="navbar-brand" title="回到首页">Ourai.WS</a> </div> <!-- 导航 --> <nav class="Page-navs navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li class="dropdown"> <a class="dropdown-toggle" href="/works/" data-toggle="dropdown">创作 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/posts/">文章</a></li> <li><a href="/videos/">视频</a></li> <li class="divider"></li> <li><a href="/moments/murmur/">想法</a></li> <li><a href="/notes/">笔记</a></li> <li><a href="https://s.ourai.ws/topics/weekly/?utm_source=ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">周报</a></li> <li class="divider"></li> <li><a href="/answers/">问答</a></li> <li><a href="/open-source/">开源</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" href="/mine/" data-toggle="dropdown">我的 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/projects/">计划</a></li> <li><a href="/people/">关系</a></li> <li class="divider"></li> <!-- 书影音 --> <li><a href="/publications/">读物</a></li> <li><a href="/dramas/">戏剧</a></li> <li class="divider"></li> <li><a href="/devices/">设备</a></li> <!-- <li><a href="#">Separated link</a></li> --> <!-- リア充 --> <li class="divider"></li> <li><a href="https://o.ourai.ws/?utm_source=ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">生活</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" href="/about/" data-toggle="dropdown">关于 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/about/">网站</a></li> <li><a href="https://linxoid.com/ourai/?utm_source=ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">站长</a></li> <li class="divider"></li> <li><a href="/sponsor/">赞助</a></li> <li><a href="https://yaol.in/cooperation/?utm_source=ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">合作</a></li> </ul> </li> <li><a href="/thanks/">致谢</a></li> </ul> </nav> </div> </div> </header> <main class="Page-content"> <!-- 页面横幅 --> <div class="Page-banner hidden-xs" style="background-image: url(/assets/posts/20210719/banner-10b49afd7da28bca9a53125f74e837c0e4a71dfb5da9baa15047408d50b16934.jpg);"> <figure class="sr-only"> <img src="/assets/posts/20210719/banner-10b49afd7da28bca9a53125f74e837c0e4a71dfb5da9baa15047408d50b16934.jpg" alt="管道线"> <figcaption>管道线</figcaption> </figure> </div> <!-- 内容主体 --> <div class="container"> <article class="Page-main Article"> <header class="Article-header"> <h1 class="Article-title">聊聊中后台前端应用：上下文的那些事儿</h1> <p><a href="https://linxoid.com/ourai/" target="_blank" rel="external nofollow">欧雷</a> 发表于 <time datetime="2021-07-19T20:46:25+08:00">2021-07-19 20:46:25</time></p> <p class="Article-commentCount"><i class="fa fa-comments"></i><a href="#disqus_thread" data-disqus-identifier="/posts/things-about-contexts-in-frontend-projects/">0 条评论</a></p> <p class="Article-tags hidden-xs"><i class="fa fa-tags"><span class="sr-only">标签：</span></i><a class="Article-tag" href="/tags/software-engineering/">软件工程</a><a class="Article-tag" href="/tags/frontend-web-development/">前端开发</a><a class="Article-tag" href="/tags/frontend-engineering/">前端工程</a></p> </header> <div class="Article-content col-md-9"> <p>经过《<a href="/posts/things-about-modules-in-frontend-projects/">聊聊中后台前端应用：模块相关的一些事</a>》和《<a href="/posts/the-system-of-ui-components-in-frontend-projects/">聊聊中后台前端应用：业务中的组件体系</a>》这两篇文章的铺垫，终于可以单独写一篇文章来专门讲讲「上下文」相关的事情了——</p> <h2 id="section">概念明晰</h2> <p>在进入正题之前，先试图厘清与主题关系密切的几个概念：状态、状态管理和上下文。</p> <h3 id="section-1">状态</h3> <p>有时会听到两拨人在打嘴仗——有一拨人说：「前端都是状态，没有数据，是状态驱动视图而不是数据驱动视图」。另一拨人反驳说：「状态难道不是数据吗？不是数据是啥？」——这两拨人的说法都没有错，只不过是站在了不同的角度。</p> <p>一般来说，「数据」是指存放在数据库、文件系统中的持久数据，是「静态」的、「持久」的，常被当作「数据源」的略称来用；「状态」则是保持在内存当中的瞬时数据，是「动态」的、「临时」的，来源于通过 HTTP 请求或本地存储读取的数据以及终端用户在界面上的操作——然而它们都是数据。</p> <p>也就是说，可以认为在经典的三层架构中数据层往上的分层中的数据都是「状态」：</p> <figure> <img src="/assets/posts/20210719/layered-architecture-705913b8aa209bb0ef9a6b14f10ca127699e36512675616c6511fabe1f443070.png" alt="「表现-领域-数据」分层架构" /> <figcaption><a href="/posts/presentation-domain-data-layering/">「表现-领域-数据」分层架构</a></figcaption> </figure> <p>对于前端来说，数据层通信的对象就是服务端和本地存储。</p> <h3 id="section-2">状态管理</h3> <p>「状态管理」是什么？顾名思义，就是对「状态」的「管理」。虽然在前端圈儿内随着 Redux 等的流行让「状态管理」成了热词，但它并不是什么新鲜货。</p> <p>世上的任何事物都需要被管理，只不过当它还没那么复杂的时候，不需要作为一门学问或者说一套方法论拿出来供人们单独讨论。</p> <p>由于前后端分离和单页面应用的出现，使得前端的状态复杂化，如何去有效地进行管理成为了问题，因此形成了现如今很多人去关注并讨论「状态管理」的局面。</p> <p>我了解到的前端项目中，它们的状态管理方案可以说是「两极分化」——要么分散在各个 UI 组件中，要么集中到一个所谓的「全局 store」中——这两种我都不太认可。</p> <h3 id="section-3">上下文</h3> <p>在《<a href="/posts/things-about-modules-in-frontend-projects/">聊聊中后台前端应用：模块相关的一些事</a>》和《<a href="/posts/the-system-of-ui-components-in-frontend-projects/">聊聊中后台前端应用：业务中的组件体系</a>》这两篇文章中都对「上下文」有所描述，简单来说，它对于程序的作用就相当于帮助人去理解事物并做出相应反应的「语境」，毕竟它们的英文都是「context」。</p> <p>在实际应用时，「上下文」很可能是一个带有很多属性及对其进行读、写操作的方法的对象。那些已经被暴露出来或没有被暴露出来的变量，就是上文所说的「状态」，而暴露出来的方法或函数就是对「状态」进行管理用的——它们共同构成了「上下文」。</p> <p>一个上下文可以用类的方式去实现：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kd">class</span> <span class="nx">ValueContext</span> <span class="p">{</span>
  <span class="kr">private</span> <span class="nx">value</span><span class="p">;</span>

  <span class="kr">constructor</span><span class="p">({</span> <span class="nx">initialValue</span> <span class="p">})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">initialValue</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">getValue</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">setValue</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">ValueContext</span><span class="p">({</span> <span class="nx">initialValue</span><span class="o">:</span> <span class="s1">&#39;Hello, Ourai!&#39;</span> <span class="p">});</span></code></pre></figure> <p>也可以用函数的方式：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kd">function</span> <span class="nx">createValueContext</span><span class="p">({</span> <span class="nx">initialValue</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">initialValue</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">getValue</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">value</span><span class="p">,</span>
    <span class="nx">setValue</span><span class="o">:</span> <span class="nx">newValue</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">),</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">createValueContext</span><span class="p">({</span> <span class="nx">initialValue</span><span class="o">:</span> <span class="s1">&#39;Hello, Ourai!&#39;</span> <span class="p">});</span></code></pre></figure> <p>无论用哪种方式实现，无论实现的具体逻辑是什么，对于上下文的消费者来说它就是一个 API——「上下文」是串起各部分逻辑，具有一定程度泛化的业务语义的接口。</p> <h2 id="section-4">组件与状态</h2> <p>交互与状态如影随形，除了那些纯展示用的 UI 组件，一般来说 UI 组件都会有与其关联的状态，只是维护的地方不同。</p> <p>根据 UI 组件自身内部是否维护了状态，可分为「无状态组件」与「有状态组件」。</p> <p>那些纯展示用的 UI 组件毋庸置疑都是「无状态组件」，而有交互的 UI 组件若是将状态维护外置，那就是「无状态组件」，否则是「有状态组件」——</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">:value</span><span class="o">=</span><span class="s">&quot;value&quot;</span> <span class="err">@</span><span class="na">input</span><span class="o">=</span><span class="s">&quot;handleInput&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ts&quot;</span><span class="p">&gt;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Component</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">StatefulInput</span> <span class="k">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="kr">private</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

  <span class="kr">private</span> <span class="nx">handleInput</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span><span class="o">:</span> <span class="ow">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></figure> <p>同样是自定义的输入框组件，上面的示例是有状态组件，而下面的则是无状态组件：</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">:value</span><span class="o">=</span><span class="s">&quot;value&quot;</span> <span class="err">@</span><span class="na">input</span><span class="o">=</span><span class="s">&quot;handleInput&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ts&quot;</span><span class="p">&gt;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">StatelessInput</span> <span class="k">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">})</span>
  <span class="kr">private</span> <span class="nx">readonly</span> <span class="nx">value</span><span class="o">!:</span> <span class="nx">string</span><span class="p">;</span>

  <span class="kr">private</span> <span class="nx">handleInput</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span><span class="o">:</span> <span class="ow">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></figure> <p>相较之下，有状态组件在保证功能正常的情况下可以暴露更少的属性和事件，但可复用性就降低了，无状态组件正好相反。</p> <p>控件通常会被设计为无状态组件，尤其是交互简单的和纯展示的；为了保证基本功能可用，交互复杂的控件可能会被设计为有状态组件。</p> <p>在封装部件时，大多数人的思路和封装控件一样，就会——</p> <blockquote> <p>在相对大粒度的部件中，如果主要依赖属性和事件进行通信的话，它们的数量很容易变得失控，并且内部的结构和逻辑也会被改得面目全非，维护起来十分困难和难受——这就变成了一坨翔💩！</p> <footer>欧雷《<cite><a href="/posts/the-system-of-ui-components-in-frontend-projects/">聊聊中后台前端应用：业务中的组件体系</a></cite>》</footer> </blockquote> <p>按照封装控件的思路去封装部件，很容易会让属性和事件的数量变得失控，或者内部各种逻辑膨胀，使部件变得十分臃肿——无论是哪种，都会加大维护成本。</p> <p>私以为，部件内部尽量不要有交互逻辑和业务逻辑，也尽可能不去维护任何状态——业务的状态与逻辑上升至上下文中，交互逻辑下沉到控件中，展现状态由业务状态计算出来——部件中理论上只有业务与交互/展现间的转换逻辑。</p> <p>理想状况下，部件中的各种依赖也是通过上下文获取的，而不是自己从哪个位置 <code>import</code> 进来的。</p> <p>说白了，在前端应用这个「有机体」中，控件和部件是具体产生功能的「组织」和「器官」，而上下文则是为它们传递信息、输送养分的「神经」和「血管」。</p> <h2 id="section-5">上下文概要</h2> <p>构成上下文的基本元素除了上文说过的要维护的状态及对其进行读、写操作的方法/函数之外，大多还会有让上下文内外数据保持一致的基本是基于观察者模式实现的同步机制。</p> <p>在本系列文章所阐述的体系中，上下文大概分为三类：应用上下文、模块上下文和数据上下文。</p> <p>「应用上下文」是作用于整个应用的上下文，如果运行时只有一个应用，那么可以把它视为是「全局」的上下文；倘若运行时中存在多个应用，那就是每个应用对应一个应用上下文。</p> <p>应用上下文中维护的是单一应用范围内共享的状态，如路由、主题、国际化等配置信息，和用户的基本信息与权限等。</p> <p>「模块上下文」主要用来维护以「模块」为中心的状态，像指定模块所依赖的其他模块的资源和它提供给其他模块的可用资源这类依赖信息，以及该模块的模型、视图、服务端动作（通过 HTTP 请求与服务端通信的函数）等元数据。</p> <p>「数据上下文」则是前端应用中使数据流动起来的主力，稍后展开说。</p> <h2 id="section-6">数据上下文</h2> <p>在继续往下说「数据上下文」之前，首先要理解在《<a href="/posts/the-system-of-ui-components-in-frontend-projects/">聊聊中后台前端应用：业务中的组件体系</a>》中提到的「<a href="/posts/the-system-of-ui-components-in-frontend-projects/#section-4">从数据的视角看前端</a>」。</p> <p>「数据上下文」又细分为「视图上下文」和「搜索上下文」，根据整个体系的复杂程度，它们可分别再往下划分出「字段上下文」和「过滤器上下文」。实际上，可以认为「搜索上下文」是为了收集列表数据过滤条件而特化了的「（对象）视图上下文」。</p> <h3 id="section-7">「值」的抽象</h3> <p>各种「数据上下文」的共同特点是对「值」的操作，因此可以围绕着「值」进行一些抽象——</p> <p>根据用途，有三种「值」的状态——一直处于活动状态的「当前值」，用 <code>value</code> 来表示；在初始化与重置时用来赋值的「初始值」和「默认值」，分别用 <code>initialValue</code> 和 <code>defaultValue</code> 来表示。</p> <p>在不同的具体数据上下文中「当前值」的含义会有所差别。比如，在对象视图上下文中它是指随着用户操作而变化的字段的键值集合，而在列表视图上下文中则是已选中的记录。</p> <p>在实际应用中，「初始值」与「默认值」的主要区别在于优先级不同，「初始值」大于「默认值」，即在没有「初始值」时才会用「默认值」。</p> <p>与「值」相关的操作基本只有 4 个，分别是对「当前值」进行读与写的 <code>getValue()</code> 和 <code>setValue()</code>，将「当前值」向外/上传递的 <code>submit()</code> 以及恢复「当前值」到「初始值」或「默认值」的 <code>reset()</code>。</p> <p>相应地，有 4 个「事件」供外界在不同时机进行数据同步用——代表数据已经准备好了的 <code>ready</code> 事件；「当前值」的每次变更都会触发 <code>change</code> 事件；调用 <code>submit()</code> 或 <code>reset()</code> 时会触发对应的 <code>submit</code> 和 <code>reset</code> 事件。</p> <p>关于 <code>ready</code> 事件，有一个使用场景是：网页加载完成后，列表数据要等过滤条件收集好了再发请求获取，但过滤条件又得先从 URL 的查询参数中恢复——这就需要列表视图上下文去监听搜索上下文的 <code>ready</code> 事件，进而去发请求获取数据。</p> <h3 id="section-8">「值」的校验</h3> <p>为了保障数据的安全及纯净，在处理数据时先进行合法性或者说有效性校验是基本操作，因此在调用 <code>setValue()</code> 时其内部会先校验一波。</p> <p>对「值」的校验实际上就是按照优先级执行一下各个约束条件。这里隐含了一个信息——约束是可以显式定义并且可扩展的。</p> <p>「值」的约束可分为来自数据类型和数据结构的自然性约束，以及源于模型关系与业务规则等的非自然性约束。这里的「自然」与否是单纯从数据的特性层面来说。</p> <h2 id="section-9">总结</h2> <p>提起「应用」这个词，很多人的第一反应是：「这个东西好重、好庞大啊！」它在他们脑中的形象就像压在孙悟空身上的五指山一样的巨石。</p> <p>而一个更好的视角是，把「应用」看作是「接口」与「实现」的组合。更准确地说，可能是「流水线」与「物料」——将不易变的、关系与规则相对固定的东西泛化并接口化，它们之间相互连接形成「流水线」；把易变的部分作为在「流水线」上流转的「物料」存在。</p> <p>就像在《<a href="/posts/the-system-of-ui-components-in-frontend-projects/">聊聊中后台前端应用：业务中的组件体系</a>》的最后，我说——</p> <blockquote> <p>理想情况下，最终会发现——除了业务逻辑，好像其余部分几乎都是接口（interface）——具体实现可以任意移除，随意替换！</p> <footer>欧雷《<cite><a href="/posts/the-system-of-ui-components-in-frontend-projects/">聊聊中后台前端应用：业务中的组件体系</a></cite>》</footer> </blockquote> <p>如果不作进一步说明，上面的描述也许会有些让人摸不着头脑——</p> <p>在一个中后台前端应用中，最易变的是业务逻辑和 UI 设计，最不易变的是「值」的自然性约束、「视图」与「字段」间的内在关系、控件的属性和事件等。</p> <p>构建一个体系，将易变的部分弄成作为「物料」存在的元数据或配置，互相连通的上下文就成为了「流水线」。</p> <div class="Article-donation"> <div class="Article-donationDetail"> <p>创作不易，若本文给你提供了价值，还请不吝<span class="Article-donationCharge">为<a href="https://linxoid.com/ourai/" target="_blank" rel="external nofollow">欧雷</a>充电</span></p> <p><img src="/assets/qrcodes/pay/wechat/donation-e2e3575287a218b650a69211a6d5e9220f9ad0314b2e946edcdc62cffcefcbd9.jpg" width="120"><img src="/assets/qrcodes/pay/alipay/ourai-2492dcf9d66d7a690e0576aa38945ad96e656b370d176c0b087638e83105844d.jpg" width="120"></p> <p>左为<span style="color: #38a138">微信</span>，右为<span style="color: #4b5dfa">支付宝</span>；充电累计 <strong>¥88</strong> 以上可在付款时备注或<a href="mailto:ourairyu+donate@gmail.com" target="_blank" rel="external nofollow">邮件</a>告知昵称和需要被链接的网址，会列在「<a href="/sponsor/#current">赞助</a>」页。其他方式与具体规则请见「<a href="/sponsor/#donation">资助</a>」。</p> </div> </div></div> <footer class="Article-footer col-md-3"> <div class="Widget Article-category"> <div class="Widget-body"> <p><i class="fa fa-pencil"></i>发布在</p> <div> <h3><a href="/categories/web-development/">网站开发</a></h3> <p>利用网页程序语言等技术进行网站和网络应用的开发与维护</p> </div> </div> </div> <div class="Widget Article-author hidden-xs hidden-sm"> <a class="Widget-body Author" href="https://linxoid.com/ourai/" title="了解欧雷" target="_blank" rel="external nofollow"> <h3 class="Author-name">欧雷</h3> <p class="Author-intro">日本深度中毒的<strong>新四有青年</strong>、<span lang="en">C<i class="fa fa-coffee"></i>ffee L<i class="fa fa-heart"></i>ver</span>，<strong>多面玩家</strong>。</p> </a> </div> <div class="Widget Article-license"> <div class="Widget-body"> <p>本文采用知识共享<i class="fa fa-creative-commons"></i><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="external nofollow">署名-非商业性使用 4.0 国际</a>许可协议，可自由转载、引用，但需署名作者并注明文章出处且不能用于商业用途。</p> </div> </div> <div class="Widget Widget--share"> <div class="Widget-body"> <p>分享到<i class="fa fa-share-alt"></i></p> <div class="social-share" data-sites="wechat,weibo,twitter"></div> </div> </div> <div class="Widget Article-series"> <div class="Widget-body"> <p><strong>聊聊中后台前端应用</strong> 系列</p> <p>中后台应用前端开发那些事儿</p> <p>共有 <a href="/series/talking-about-frontend-of-web-based-management-systems/">5</a> 篇文章，<a href="/series/talking-about-frontend-of-web-based-management-systems/">前往围观 &gt;</a></p> </div> </div> <section class="Widget Widget--toc"> <div class="Widget-header"> <h2 class="Widget-title">目录</h2> </div> <div class="Widget-body"></div> </section> </footer> <!-- 相邻文章 --> <nav class="Article-siblings LightBox col-md-9"> <ul> <li class="Sibling Sibling--previous"> <a href="/posts/the-system-of-ui-components-in-frontend-projects/" style="background-image: url('/assets/posts/20210716/banner-c64098093e8de8c815694fcc34ca9f0cd4cee80e99fe9c586c72152ccdcf88f0.png');"> <h3>聊聊中后台前端应用：业务中的组件体系</h3> <p>在我写的其他系列的文章中有提到——</p> </a> </li> <li class="Sibling Sibling--next"> <a href="/posts/hello-world-from-anti-chaos/" style="background-image: url('/assets/posts/20211030/banner-e24c0b84f8b0b1342b7eb9e7f551536247c060560a1fac7c44f0d60752ac465a.jpg');"> <h3>说说「反混沌」：Hello, World!</h3> <p>「反混沌」，英文是「Anti-chaos」，简称为「NTKS」，是一种思想，是一个计划，是一个体系，是一个组织，也是一个社区。</p> </a> </li> </ul> </nav> <!-- 评论区 --> <div class="Article-comments col-md-9"> <div id="disqus_thread"></div> <script type="text/javascript" src="/assets/disqusjs.min-4aa6c162858d0f13ecf2af9524ee286e764a5989b6c891b736e5a70e0a520522.js"></script> <script> var dsqjs = new DisqusJS({ shortname: 'ourairyu', siteName: '欧雷流', identifier: '/posts/things-about-contexts-in-frontend-projects/', url: 'http://' + location.host + '/posts/things-about-contexts-in-frontend-projects/', title: '聊聊中后台前端应用：上下文的那些事儿', api: 'https://disqus.skk.moe/disqus/', apikey: 'Ht1OT36NinKAkkNd2l0goxrLqXDGMg1zJKWx7309PWDunyGh6jbjRt3JUmvgHSIn', admin: 'ourai', adminLabel: '鹳狸猿' }); </script> </div> </article> </div> </main> <footer class="Page-footer Footer"> <div class="container"> <div class="Footer-description"> <!-- 重要链接 --> <nav class="Footer-navs"> <ul> <li><a href="https://meta.ourai.ws/?utm_source=ourai.ws&utm_medium=common-footer" title="访问「欧雷宇宙」" target="_blank" rel="external nofollow"><span>@</span></a></li> <li><a href="/about/"><span>关于</span></a></li> <li><a href="/sponsor/"><span>赞助</span></a></li> <li><a href="/topics/"><span>专题</span></a></li> <li><a href="/projects/"><span>计划</span></a></li> <li><a href="/thanks/"><span>致谢</span></a></li> <li><a href="https://yaol.in/cooperation/?utm_source=ourai.ws&utm_medium=common-footer" target="_blank" rel="external nofollow"><span>合作</span></a></li> </ul> </nav> <!-- 网站版权 --> <div class="Footer-copyright"> <p>&copy; 2009-2025 <a href="/">欧雷流</a> 版权所有</p> <p>采用 <a href="http://jekyllrb.com" target="_blank" rel="external nofollow">Jekyll</a> 生成 ♥ 版本为 <span title="构建于 2025-02-21 22:54">v3046f1b</span></p> </div> <div class="Footer-licenses"> <p><a href="http://beian.miit.gov.cn" target="_blank" rel="external nofollow">浙ICP备16006930号-1</a></p> <p><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602005556" target="_blank" rel="external nofollow">浙公网安备 33010602005556号</a></p> </div> <!-- 社交网站 --> <div class="Footer-links hidden-xs"> <ul> <li class="Icon Icon--email"><a href="mailto:ourairyu@gmail.com" title="发送邮件给我" target="_blank" rel="external nofollow">ourairyu@gmail.com</a></li> <li class="Icon Icon--gh"><a href="https://github.com/ourai" title="查看我的全部开源项目" target="_blank" rel="external nofollow">GitHub</a></li> <li class="Icon Icon--zh"><a href="https://www.zhihu.com/people/ourai" target="_blank" rel="external nofollow">知乎</a></li> </ul> </div> </div> </div> </footer> <script type="text/javascript" src="/assets/share.min-3155ee636b84a04d036e0f1ba833227d3fd03a4c58a6f2e21c9ceb1c5d0198c7.js"></script><script type="text/javascript" src="/assets/components-a266f21fe1dfd61bebf40e74872cbf901eb3e201f7d33e9e5d5af9a55f4b24ea.js"></script> <script type="text/javascript" src="/assets/initializers/time-8d7a529a66ae6cb53c2283d21fd6a12c538b8473dd5bd76458366d09adce7bf6.js"></script><script type="text/javascript" src="/assets/initializers/lazyload-44b7df8a9282d598284d522e64d6be9ac88d466f3c4a734a514303e99347b2c9.js"></script> </body> </html>
