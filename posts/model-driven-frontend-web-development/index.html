<!DOCTYPE html> <html lang="zh-CN" dir="ltr"> <head> <meta charset="UTF-8"> <!-- SEO --> <title>我来聊聊模型驱动的前端开发</title> <meta property="og:title" content="我来聊聊模型驱动的前端开发"> <meta name="description" content="合理且完善的模型驱动架构的设计与实现，能够很好地支撑企业业务的变化，快速搭建新的应用。"> <meta property="og:description" content="合理且完善的模型驱动架构的设计与实现，能够很好地支撑企业业务的变化，快速搭建新的应用。"> <meta name="keywords" content="软件工程,软件架构,前端开发,前端工程,前端架构"> <link rel="canonical" href="https://ourai.ws/posts/model-driven-frontend-web-development/"> <meta property="og:url" content="https://ourai.ws/posts/model-driven-frontend-web-development/"> <meta property="og:site_name" content="欧雷流"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "WebSite", "name" : "欧雷流", "url" : "https://ourai.ws" } </script> <meta property="og:image" content="https://ourai.ws/assets/posts/20200528/banner-55cf67651af5c8b05ed4d3a2ba11adbfc0835828cf8a3f6315115c6953e2750a.jpg"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2020-05-28T12:30:49+08:00"> <link rel="next" href="https://ourai.ws/posts/life-metaprogramming/" title="人生元编程"> <link rel="prev" href="https://ourai.ws/posts/the-future-of-frontend-web-development/" title="前端有未来吗？"> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "NewsArticle", "headline": "我来聊聊模型驱动的前端开发", "image": "/assets/posts/20200528/banner-55cf67651af5c8b05ed4d3a2ba11adbfc0835828cf8a3f6315115c6953e2750a.jpg", "datePublished": "2020-05-28T12:30:49+08:00", "description": "合理且完善的模型驱动架构的设计与实现，能够很好地支撑企业业务的变化，快速搭建新的应用。" } </script> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "person", "name" : "欧雷流", "url" : "https://ourai.ws", "sameAs" : null } </script> <link rel="author" href="https://ourai.ws"> <!-- 页面渲染兼容性 --> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="renderer" content="webkit"> <meta name="viewport" content="width=device-width,initial-scale=1.0"> <!-- 订阅 --> <link type="application/atom+xml" rel="alternate" href="https://ourai.ws/atom.xml" title="欧雷流" /> <link type="application/rss+xml" rel="alternate" href="//ourai.ws/rss.xml" title="欧雷流"> <meta name="theme-color" content="#0871ab"> <link rel="icon" href="/assets/favicon-3e749ca030e3b71eb2662d947c789061d2da9e0f4ee5f3360cfa9ccbe053c8ba.ico"> <!-- 静态资源 --> <link type="text/css" rel="stylesheet" href="/assets/disqusjs.min-b077139304675330d06888b873bd88158951637593a3c17c4674bc855caf71af.css"> <link type="text/css" rel="stylesheet" href="/assets/global-b623500154e70cdef18bd463a0ef409c46da6d1ad99756cf169ddb354874bcbc.css"> <link type="text/css" rel="stylesheet" href="/assets/share-2811f36e337fef8021089414f657904b7e88db17d8ecade0688c8c3f5e632a5c.css"> <link type="text/css" rel="stylesheet" href="/assets/pages/post-d5f1244d69bfc31e3c7b73b16140ed8a09f0b5af40515abeae522bee80e92ec9.css"> <script type="text/javascript" src="/assets/statistic-ae0fea4509b55747b1bcc6318c58abf5817e03e26505a307f438b42f0c6783bc.js"></script> <script type="text/javascript" src="/assets/global-b3a80dd53acf48ad7228d6fd741dba15d3845cbc3783bdbbf7244151a45628aa.js"></script> <!--[if lt IE 9]> <script type="text/javascript" src="/assets/support_ie8-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js"></script> <![endif]--> </head> <body class="Page has-headerImage" itemscope itemtype="http://schema.org/WebPage"> <header class="Page-header"> <div class="navbar navbar-static-top"> <div class="container"> <div class="navbar-header"> <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse"> <span class="sr-only">切换导航</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a href="/" class="navbar-brand" title="回到首页">Ourai.WS</a> </div> <!-- 导航 --> <nav class="Page-navs navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li class="dropdown"> <a class="dropdown-toggle" href="/works/" data-toggle="dropdown">创作 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/posts/">文章</a></li> <li><a href="/videos/">视频</a></li> <li class="divider"></li> <li><a href="/moments/murmur/">想法</a></li> <li><a href="/notes/">笔记</a></li> <li><a href="https://s.ourai.ws/topics/weekly/?utm_source=ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">周报</a></li> <li class="divider"></li> <li><a href="/answers/">问答</a></li> <li><a href="/open-source/">开源</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" href="/mine/" data-toggle="dropdown">我的 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/projects/">计划</a></li> <li><a href="/people/">关系</a></li> <li class="divider"></li> <!-- 书影音 --> <li><a href="/publications/">读物</a></li> <li><a href="/dramas/">戏剧</a></li> <li class="divider"></li> <li><a href="/devices/">设备</a></li> <!-- <li><a href="#">Separated link</a></li> --> <!-- リア充 --> <li class="divider"></li> <li><a href="https://o.ourai.ws/?utm_source=ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">生活</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" href="/about/" data-toggle="dropdown">关于 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/about/">网站</a></li> <li><a href="https://linxoid.com/ourai/?utm_source=ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">站长</a></li> <li class="divider"></li> <li><a href="/sponsor/">赞助</a></li> <li><a href="https://yaol.in/cooperation/?utm_source=ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">合作</a></li> </ul> </li> <li><a href="/thanks/">致谢</a></li> </ul> </nav> </div> </div> </header> <main class="Page-content"> <!-- 页面横幅 --> <div class="Page-banner hidden-xs" style="background-image: url(/assets/posts/20200528/banner-55cf67651af5c8b05ed4d3a2ba11adbfc0835828cf8a3f6315115c6953e2750a.jpg);"> <figure class="sr-only"> <img src="/assets/posts/20200528/banner-55cf67651af5c8b05ed4d3a2ba11adbfc0835828cf8a3f6315115c6953e2750a.jpg" alt="Digital Twin"> <figcaption>Digital Twin</figcaption> </figure> </div> <!-- 内容主体 --> <div class="container"> <article class="Page-main Article"> <header class="Article-header"> <h1 class="Article-title">我来聊聊模型驱动的前端开发</h1> <p><a href="https://linxoid.com/ourai/" target="_blank" rel="external nofollow">欧雷</a> 发表于 <time datetime="2020-05-28T12:30:49+08:00">2020-05-28 12:30:49</time></p> <p class="Article-commentCount"><i class="fa fa-comments"></i><a href="#disqus_thread" data-disqus-identifier="/posts/model-driven-frontend-web-development/">0 条评论</a></p> <p class="Article-tags hidden-xs"><i class="fa fa-tags"><span class="sr-only">标签：</span></i><a class="Article-tag" href="/tags/software-engineering/">软件工程</a><a class="Article-tag" href="/tags/software-architecture/">软件架构</a><a class="Article-tag" href="/tags/frontend-web-development/">前端开发</a><a class="Article-tag" href="/tags/frontend-engineering/">前端工程</a><a class="Article-tag" href="/tags/frontend-architecture/">前端架构</a></p> </header> <div class="Article-content col-md-9"> <p>如果把「客户端」想成是楼，把「数据」想成是水——「Model」就是这幢楼的蓄水池，提供充足的水源；「ViewModel」是将蓄水池里的水进行净化等加工的地方，然后输送给挨家挨户；「View」部分的每个 UI 组件就是「挨家挨户」，对水进行消费的地方。</p> <h2 id="section">一切皆为模型</h2> <p>模型是人们根据事物特征将它们分类并抽象后的结果，建模是人们认知世界的一种方式。</p> <h3 id="section-1">模型驱动</h3> <p>数字世界这种虚拟空间，里面本无一物，是个需要被人开垦的空虚的世界。那么人该如何打造数字世界呢？</p> <p>就像《圣经》里描述的——上帝按照自己的样子创造了亚当这个世上第一个人类，又从他身上取下一根肋骨创造了夏娃这个世界上第二个人类。在这里，上帝将自己作为参照提取特征抽象出祂所认为的「人」的模型，并根据这个模型创造出「亚当」和「夏娃」。</p> <p>人在打造数字世界时必然会参照自己所存在的并且是自己所认知的世界，因为人不可能想像出自己无法认知的事物。人们所抽象的现实世界的事物的模型，就成了建设数字世界的基础，而数据则为构造数字世界的基本单元，数字世界成了现实世界的映射。</p> <p>模型是数字世界万物的概念，程序是将概念具像化的工具，打造数字世界需从建模开始。</p> <h3 id="section-2">领域驱动</h3> <p>上面说了在打造数字世界时首先要建立模型，然后以模型为中心开始建造。那么要怎样进行建模呢？</p> <p>至今为止，软件工程发展这么多年，产生了很多方法论，其中「领域驱动设计」在构建大型软件时是被广泛采纳的实践方法。它的核心就是针对问题域分析并建立领域模型，理出模型间的关系及业务逻辑。</p> <p>领域驱动设计最常用在商业层面的模型上，如：包含名称、编号、规格、出厂日期等信息的商品模型；同时也可以用在技术层面的模型上，如：包含名称、编码、字段、关系、约束等用来描述模型的信息的模型。前者称之为「业务模型」，后者则是「元模型」。业务模型可以被元模型描述。</p> <p>如果把模型映射为数据库表，那么元模型所对应的表中的每条记录都是元数据，业务模型所对应的表中的每条记录都是业务数据。</p> <h2 id="mvvm-">MVVM 架构</h2> <p>标准的 MVVM 架构是 Model-View-ViewModel 三部分：</p> <figure> <img src="/assets/posts/20200528/mvvm-pattern-62cd12b4ab7b416dffa784d6879489922586ccfc40b3b7ef7096ea8aa1b508e2.png" alt="「MVVM」架构" /> <figcaption>图片来自 <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel" target="_blank" rel="external nofollow">Wikipedia</a></figcaption> </figure> <p>而这里所说的如下图所示：</p> <figure> <img src="/assets/posts/20200528/mvavm-model-feb54922cbf8e7f8c4e58acfe8763d98a61e0d83d4b84f3fb70e726e90279633.jpg" alt="「MVAVM」架构" /> <figcaption>「MVAVM」架构</figcaption> </figure> <p>从图中可以看到，多了个「Action」，所以实际上应该是 Model-View-ViewModel-Action 四部分。它们之间彼此分离，以组合的方式协同工作。</p> <p>为了讲究对称美，将这种架构简称为「MVAVM」。</p> <h3 id="section-3">模型</h3> <p>模型的主要职责是前、后端协议处理，以及对数据进行读写操作。</p> <p>前、后端协议的处理包括元数据适配和 HTTP 请求构造。与后端对接的工作都控制在这一层，其他层的运作都基于这层适配后的结果。</p> <p>在这层中进行读写的数据，既有业务数据又有元数据。元数据只加载一次，将适配后的结果进行缓存；业务数据只暂时缓存尚未持久化的处于草稿状态的记录，持久化之后会将其删除。</p> <h3 id="viewmodel">ViewModel</h3> <p>VM 的职责很单纯，就是处理业务数据流转相关的逻辑，即数据的分发、汇总与联动。理论上，在这层不直接进行任何与请求服务、执行动作相关的处理。</p> <p>正如文章开头所说——在一个应用中，数据是像水一样不断流动的，在此过程中，VM 应该起到铺设输送管线与在特定节点对数据进行处理的作用。根据这一特点，可以考虑采用<a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/pipes-and-filters" target="_blank" rel="external nofollow">管道和过滤器模式</a>：</p> <figure> <img src="/assets/posts/20200528/pipes-and-filters-pattern-f0df1428108c3b3c8cf0309b4caac02dc8a235475be07cbcbeb333af26e618f2.png" alt="Pipes and Filters pattern" /> <figcaption>图片来自 <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/pipes-and-filters" target="_blank" rel="external nofollow">Microsoft Build</a></figcaption> </figure> <h4 id="section-4">实例与数据的关系</h4> <p>每个 VM 实例都来源于数据，是数据的变形，是具备能力的数据。</p> <p>根据数据源的形态，VM 实例大致分为列表、对象和值三种。如果值是布尔、数字、字符串等简单类型，那就即刻终止；若值为对象、列表等复杂类型，则要递归下去，直到末端为简单类型。</p> <p>需要注意的是，VM 实例与数据一一对应，其实质就是数据本身，而不是数据的容器。也就是说，VM 实例不是装水的瓶子，不能把已经装的水倒掉换些水进来，而是一起丢弃。</p> <h4 id="section-5">生命周期</h4> <p>任何对象的生命周期都可粗略地分为初始化、活动中与销毁三个阶段。</p> <p>在初始化时根据策略获取自身数据源，与上级 VM 实例创建的流进行对接形成数据管道，然后创建向外推送自身变化的流。</p> <p>活动期间就是不断地与外界进行数据交换：</p> <ol> <li>视图输入变化时，通过对应的 VM 实例提交自身的数据变更</li> <li>在处理被提交的输入数据时会对其进行保留，并发出有数据提交的信号 <ol> <li>自身的数据变化会通过数据管道流向下级 VM 实例</li> <li>外部（主要是上级）接收到信号后会做些后续处理</li> </ol> </li> </ol> <p>销毁时做些清理、善后的工作，如：移除子 VM 引用，取消订阅等。</p> <h4 id="section-6">数据流转</h4> <p>在活动期间，数据在各层 VM 实例所连通的数据管道中流转时会发生变化，为了方便在不同场景下对数据进行处理，需要在初始化 VM 实例时将数据源进行备份，并生成几个拷贝：初始值（initial value）、默认值（default value）、原始值（data source）和当前值（current value）。</p> <p>其中，初始值是获取到数据源那一刻的值，默认值在没有指定的情况下与初始值相同，它们都是一经初始化就不会改变的；当前值是自身一段时间内的数据变更，是最新的但不确定的值，可以理解为是一种草稿状态的值；原始值只有在上级当前值变动，接收到下级提交的数据或强制更新时才会更新，它是阶段性的确定值，可以看作是可靠的数据。</p> <p>「原始值」中的「原始」也许会容易让人误解。在这里，它的含义是相对于「当前值」来说，它是「原始」的，可以拿来作为参考的，而不是「最初的值」。表达「最初的值」的含义的是「初始值」。</p> <p>原始值与当前值的区别与特点是：</p> <ul> <li>原始值是确定的，当前值是不确定的；</li> <li>原始值是纯的，当前值是脏的；</li> <li>通过「提交（commit）」操作对各级的原始值、当前值进行同步；</li> <li>当前值的「版本」始终不落后于原始值；</li> <li>有些场景下原始值与当前值始终相同。</li> </ul> <p>数据在流转时遵循以下几个原则：</p> <ul> <li>自身的原始值变动会引起自身的当前值以及子孙级的原始值和当前值变动，子孙可以定义抛弃变动的规则；</li> <li>自身的当前值变动在没提交时不会影响自身的原始值，会引起子孙级的原始值和当前值变动，子孙可以定义抛弃变动的规则；</li> <li>将自身的当前值提交到上级后，不会引起回流，兄弟 VM 实例也不会发生变化。</li> </ul> <p>总的来说，只有在上级引发数据变动的情况下，才会发生上到下的数据流动。</p> <p>各层级 VM 实例之间数据的传递过程大致如下：</p> <figure> <img src="/assets/posts/20200528/vm-data-stream-6aed6f2d61ae90a0152c73fc22556cdca104c9cd16a9f2f6a72ac36e1d8033db.svg" alt="数据流转" /> <figcaption>数据流转</figcaption> </figure> <h4 id="section-7">过滤器</h4> <p>在数据通过上下级 VM 实例之间所连通的数据管道，即数据的分发与汇总时，会经过一系列相对独立的逻辑的处理，如：数据的裁剪、变形、校验等。每一段处理逻辑就是一个「过滤器」，每个过滤器都可以抛出异常终止后续的操作。</p> <h4 id="section-8">与视图的交互</h4> <p>每个 VM 实例都会提供一些供视图进行状态同步、数据联动等的接口：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">interface</span> <span class="nx">IViewModel</span><span class="o">&lt;</span><span class="nx">ValueType</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">// 获取原始值</span>
  <span class="nx">getDataSource</span><span class="p">()</span><span class="o">:</span> <span class="nx">ValueType</span><span class="p">;</span>
  <span class="c1">// 设置原始值</span>
  <span class="nx">setDataSource</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">ValueType</span><span class="p">)</span><span class="o">:</span> <span class="ow">void</span><span class="p">;</span>

  <span class="c1">// 获取当前值</span>
  <span class="nx">getCurrentValue</span><span class="p">()</span><span class="o">:</span> <span class="nx">ValueType</span><span class="p">;</span>
  <span class="c1">// 设置当前值</span>
  <span class="nx">setCurrentValue</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">ValueType</span><span class="p">)</span><span class="o">:</span> <span class="ow">void</span><span class="p">;</span>

  <span class="c1">// 监听当前值变化</span>
  <span class="nx">watch</span><span class="p">(</span><span class="nx">handler</span><span class="o">:</span> <span class="nb">Function</span><span class="p">)</span><span class="o">:</span> <span class="nx">Subscription</span><span class="p">;</span>

  <span class="c1">// 监听提交等事件</span>
  <span class="nx">on</span><span class="p">(</span><span class="nx">handlers</span><span class="o">:</span> <span class="p">{[</span><span class="nx">key</span><span class="o">:</span> <span class="nx">string</span><span class="p">]</span><span class="o">:</span> <span class="nb">Function</span><span class="p">})</span><span class="o">:</span> <span class="ow">void</span><span class="p">;</span>

  <span class="c1">// 在分发数据的过滤器队列头部添加一个过滤器</span>
  <span class="nx">prependDispatchFilter</span><span class="p">(</span><span class="nx">filter</span><span class="o">:</span> <span class="nb">Function</span><span class="p">)</span><span class="o">:</span> <span class="ow">void</span><span class="p">;</span>
  <span class="c1">// 在分发数据的过滤器队列尾部添加一个过滤器</span>
  <span class="nx">appendDispatchFilter</span><span class="p">(</span><span class="nx">filter</span><span class="o">:</span> <span class="nb">Function</span><span class="p">)</span><span class="o">:</span> <span class="ow">void</span><span class="p">;</span>

  <span class="c1">// 在提交数据的过滤器队列头部添加一个过滤器</span>
  <span class="nx">prependCommitFilter</span><span class="p">(</span><span class="nx">filter</span><span class="o">:</span> <span class="nb">Function</span><span class="p">)</span><span class="o">:</span> <span class="ow">void</span><span class="p">;</span>
  <span class="c1">// 在提交数据的过滤器队列尾部添加一个过滤器</span>
  <span class="nx">appendCommitFilter</span><span class="p">(</span><span class="nx">filter</span><span class="o">:</span> <span class="nb">Function</span><span class="p">)</span><span class="o">:</span> <span class="ow">void</span><span class="p">;</span>

  <span class="c1">// 获取上级 VM 实例</span>
  <span class="nx">getParent</span><span class="p">()</span><span class="o">:</span> <span class="nx">IViewModel</span><span class="p">;</span>
  <span class="c1">// 获取下级 VM 实例</span>
  <span class="nx">getChildren</span><span class="p">()</span><span class="o">:</span> <span class="nx">IViewModel</span><span class="p">[];</span>

  <span class="c1">// 获取模型，返回值包含发请求的 API</span>
  <span class="nx">getModel</span><span class="p">()</span><span class="o">:</span> <span class="nx">IModel</span><span class="p">;</span>

  <span class="c1">// 执行动作，不指定 VM 实例的话使用当前 VM 实例</span>
  <span class="nx">call</span><span class="p">(</span><span class="nx">action</span><span class="o">:</span> <span class="nx">IAction</span><span class="p">,</span> <span class="nx">vm</span><span class="o">?:</span> <span class="nx">IViewModel</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure> <h3 id="section-9">动作</h3> <p>关于「动作」是什么，在之前的文章《<a href="/posts/configuration-driven-frontend-web-development/" target="_blank">我来聊聊配置驱动的视图开发</a>》中已经提及——</p> <blockquote> <p>「动作」是一段完整逻辑的抽象，与函数相当，用来描述且只描述「做什么事」，不描述「长什么样」。一个可复用的动作应该是原子化的。</p> <p>根据逻辑的定义、执行所在位置，可以分为客户端动作（广义）与服务端动作：客户端动作（广义）是定义并且执行在前端；服务端动作是定义并且执行在后端。</p> <p>客户端动作（广义）根据具体场景的用途及特性，又可分为以下几种动作：</p> <ul> <li>路由动作</li> <li>CRUD 动作</li> <li>客户端动作（狭义）</li> <li>组合动作</li> </ul> <p>其中，路由动作的作用是进行页面跳转；CRUD 动作是对数据进行操作；客户端动作（狭义）是单纯的一段逻辑，可以简单理解为是一个 JS 函数；组合动作用于将其他类型的动作「打包」处理，就像一个调用了其他函数的函数。</p> <p>服务端动作可以简单粗暴地理解为是非常规 CRUD 的后端接口。</p> <footer>欧雷《<cite><a href="/posts/configuration-driven-frontend-web-development/" target="_blank">我来聊聊配置驱动的视图开发</a></cite>》</footer> </blockquote> <p>除了客户端动作（狭义）需要自己写逻辑之外，其他的都是完全根据元数据执行。</p> <p>路由动作是进行页面跳转的动作，这里的「页面」是广义的，根据情景，可以理解为是浏览器窗口中的整个页面，也可以理解为是某个视图所在的宿主。在这个体系里，将视图跳转的动作称为「视图动作」，跳转到当前应用之外的页面的叫做「页面动作」。</p> <p>既然组合动作是将其他类型的动作「打包」处理的动作，那么它就得具备调整被「打包」的动作的执行顺序及如果某个动作执行失败要终止后续处理等的控制能力。实现方式可以参考 <a href="https://en.wikipedia.org/wiki/Continuation" target="_blank" rel="external nofollow">continuation</a> 在 JS 中的实践应用。</p> <h3 id="section-10">视图</h3> <p>解析视图描述信息，并根据注入的 VM 实例所携带的数据进行渲染。</p> <p>视图中可以自己发请求，但理论上只能发获取数据的请求，不能发修改数据的，修改数据需要通过 VM 实例或动作去处理。</p> <p>视图这部分又细分为描述层、包装层和渲染层：</p> <figure> <img src="/assets/posts/20200528/view-layer-f72e28e0a4c130bb0b3e83ea76a6b00e2a0e85295ff4af302cc7b10d6964889d.png" alt="视图层架构" /> <figcaption>视图层架构</figcaption> </figure> <p>「描述层」即「DSL 层」，通过内部定义的 XML 标签集去描述一个界面中的 UI 元素、数据等信息，是一种相较于 JSON 来说更符合直觉，更容易理解的界面配置。</p> <p>包装层的作用是将描述层的标签转换为实际渲染的部件，渲染层则是具体的运行时环境。不像描述层那样相对独立，包装层和描述层可以说是不能分离的，包装层在将描述层的标签转换为实际渲染的部件时需要渲染层的支撑。</p> <p>包装层的包装器与描述层的标签集里的标签可以说是一一对应的，标签通过包装器转换为部件集里的部件，但部件却不一定与包装器一一对应，很可能一个包装器对应多个同类别的部件。</p> <h4 id="section-11">描述层</h4> <p>在 web 前端开发中，HTML 是一种 DSL，CSS 也是一种 DSL。在这个模型驱动的体系里，内部定义的用来描述一个界面中的 UI 元素、数据等信息的 XML 标签集就是 DSL。</p> <p>描述层是运行时无关的，能够在任何平台及运行时库中运行。</p> <p>日常工作交流中常会说到「模板」，这个词在不同语境中代表着不同的东西。在这个体系中，当在开发的语境里时，如果没带任何修饰词，应该就是指「一段描述界面配置的标签」，如：</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;view</span> <span class="na">widget=</span><span class="s">&quot;form&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;group</span> <span class="na">title=</span><span class="s">&quot;基本信息&quot;</span> <span class="na">widget=</span><span class="s">&quot;fieldset&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">label=</span><span class="s">&quot;姓名&quot;</span> <span class="na">widget=</span><span class="s">&quot;input&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;gender&quot;</span> <span class="na">label=</span><span class="s">&quot;性别&quot;</span> <span class="na">widget=</span><span class="s">&quot;radio&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;age&quot;</span> <span class="na">label=</span><span class="s">&quot;年龄&quot;</span> <span class="na">widget=</span><span class="s">&quot;number&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;birthday&quot;</span> <span class="na">label=</span><span class="s">&quot;生日&quot;</span> <span class="na">widget=</span><span class="s">&quot;date-picker&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/group&gt;</span>
  <span class="nt">&lt;group</span> <span class="na">title=</span><span class="s">&quot;宠物&quot;</span> <span class="na">widget=</span><span class="s">&quot;fieldset&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;dogs&quot;</span> <span class="na">label=</span><span class="s">&quot;🐶&quot;</span> <span class="na">widget=</span><span class="s">&quot;select&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;cats&quot;</span> <span class="na">label=</span><span class="s">&quot;🐱&quot;</span> <span class="na">widget=</span><span class="s">&quot;select&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/group&gt;</span>
  <span class="nt">&lt;action</span> <span class="na">ref=</span><span class="s">&quot;submit&quot;</span> <span class="na">text=</span><span class="s">&quot;提交&quot;</span> <span class="na">widget=</span><span class="s">&quot;button&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;action</span> <span class="na">ref=</span><span class="s">&quot;reset&quot;</span> <span class="na">text=</span><span class="s">&quot;重置&quot;</span> <span class="na">widget=</span><span class="s">&quot;button&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;action</span> <span class="na">ref=</span><span class="s">&quot;cancel&quot;</span> <span class="na">text=</span><span class="s">&quot;取消&quot;</span> <span class="na">widget=</span><span class="s">&quot;button&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/view&gt;</span></code></pre></figure> <p>模板如果不去解析，它就只是一段普通的文本，没有任何作用。</p> <p>要对模板进行解析，得有一套对应模板上标签的标签集，还需有能将纯文本的模板借助标签集转换成 JS 对象的解析器。</p> <p>标签集中的每个标签，也可以称为「元素」。考虑到扩展性，需要有元素注册的机制，这有助于元素属性等的规范和管理。</p> <p>在注册元素时，需要指定一些关键信息，如：元素名、标签名、属性描述符、行为。「属性描述符」主要是用来声明该元素所支持的属性及其值的类型；「行为」则用来告知该元素在解析后是作为父节点的子节点还是属性存在。</p> <p>所有作为子节点存在的元素，基本都对应一个具体的部件。从表意上来说，这些元素分为两类：一类是较为抽象的，另一类是较为具象的。较为抽象的元素只有一个，它仅单纯地表达是「部件」这个含义，并没有更具体地体现出是干嘛的；其他的元素都是具象的，像 <code>&lt;view&gt;</code>、<code>&lt;field&gt;</code> 等，从命名就知道是用于哪方面的。</p> <p>所谓「节点」，就是将模板中的元素编译解析后所转换成的 JS 对象。整个模板会解析成一个树状结构的 JS 对象，也就是「节点树」。每个节点可以有一些方法，用来新增子节点、删除自身、获取或修改自身信息等。</p> <h4 id="section-12">包装层</h4> <p>包装层的作用是将描述层的产物，即节点，转换为部件。在 DSL 节点与部件之间起到桥梁作用的，就是「包装器」。</p> <p>包装器里面汇集了描述层所产出的一些信息，如：要生成到界面中的节点的属性及其对应部件的配置等。会根据节点所对应的元素所引用的部件的标识符去查找相应的部件，如果没指定引用则使用默认的，并将其他属性及相关联部件的配置作为部件的属性进行传递。</p> <h4 id="section-13">渲染层</h4> <p>简单来说，渲染层就是像 Vue、React、iOS、Android、微信小程序之类的库/框架、平台的运行时环境。进行实际渲染的组件、部件及作为桥梁的包装器都对其依赖，这就需要在每个运行环境下都得有一套包装器、组件和部件的封装。</p> <h2 id="section-14">思想总结</h2> <p>模型驱动架构正符合我在《<a href="/posts/architecture-of-frontend-application/" target="_blank">前端有架构吗？</a>》所提到的架构设计的首要核心原则——以不变为中心。</p> <p>在这个体系中，根据不同层、不同角色的设计目标，需要采用适合的编程范式，而不局限于一种。如：模型主要用 OOP，VM 使用 OOP 和 FRP，动作用到 FP。</p> <p>合理且完善的模型驱动架构的设计与实现，能够很好地支撑企业业务的变化，快速搭建新的应用。</p> <p>数据处理相关的架构设计就到这里。</p> <p>以上。</p> <div class="Article-donation"> <div class="Article-donationDetail"> <p>创作不易，若本文给你提供了价值，还请不吝<span class="Article-donationCharge">为<a href="https://linxoid.com/ourai/" target="_blank" rel="external nofollow">欧雷</a>充电</span></p> <p><img src="/assets/qrcodes/pay/wechat/donation-e2e3575287a218b650a69211a6d5e9220f9ad0314b2e946edcdc62cffcefcbd9.jpg" width="120"><img src="/assets/qrcodes/pay/alipay/ourai-2492dcf9d66d7a690e0576aa38945ad96e656b370d176c0b087638e83105844d.jpg" width="120"></p> <p>左为<span style="color: #38a138">微信</span>，右为<span style="color: #4b5dfa">支付宝</span>；充电累计 <strong>¥88</strong> 以上可在付款时备注或<a href="mailto:ourairyu+donate@gmail.com" target="_blank" rel="external nofollow">邮件</a>告知昵称和需要被链接的网址，会列在「<a href="/sponsor/#current">赞助</a>」页。其他方式与具体规则请见「<a href="/sponsor/#donation">资助</a>」。</p> </div> </div></div> <footer class="Article-footer col-md-3"> <div class="Widget Article-category"> <div class="Widget-body"> <p><i class="fa fa-pencil"></i>发布在</p> <div> <h3><a href="/categories/web-development/">网站开发</a></h3> <p>利用网页程序语言等技术进行网站和网络应用的开发与维护</p> </div> </div> </div> <div class="Widget Article-author hidden-xs hidden-sm"> <a class="Widget-body Author" href="https://linxoid.com/ourai/" title="了解欧雷" target="_blank" rel="external nofollow"> <h3 class="Author-name">欧雷</h3> <p class="Author-intro">日本深度中毒的<strong>新四有青年</strong>、<span lang="en">C<i class="fa fa-coffee"></i>ffee L<i class="fa fa-heart"></i>ver</span>，<strong>多面玩家</strong>。</p> </a> </div> <div class="Widget Article-license"> <div class="Widget-body"> <p>本文采用知识共享<i class="fa fa-creative-commons"></i><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="external nofollow">署名-非商业性使用 4.0 国际</a>许可协议，可自由转载、引用，但需署名作者并注明文章出处且不能用于商业用途。</p> </div> </div> <div class="Widget Widget--share"> <div class="Widget-body"> <p>分享到<i class="fa fa-share-alt"></i></p> <div class="social-share" data-sites="wechat,weibo,twitter"></div> </div> </div> <div class="Widget Article-series"> <div class="Widget-body"> <p><strong>我来聊聊「X」</strong> 系列</p> <p>聊聊我对「X」的理解</p> <p>共有 <a href="/series/let-me-talk-about-x/">5</a> 篇文章，<a href="/series/let-me-talk-about-x/">前往围观 &gt;</a></p> </div> </div> <section class="Widget Widget--toc"> <div class="Widget-header"> <h2 class="Widget-title">目录</h2> </div> <div class="Widget-body"></div> </section> </footer> <!-- 相邻文章 --> <nav class="Article-siblings LightBox col-md-9"> <ul> <li class="Sibling Sibling--previous"> <a href="/posts/the-future-of-frontend-web-development/" style="background-image: url('/assets/posts/20200511/banner-6223d1f2cc7b79989f1833821e2be305a6d815e793e8da21ef6dfd8a02d88200.jpg');"> <h3>前端有未来吗？</h3> <p>最近一段时间，通过各种方式与同行们交流了「前端技术」与「前端工程师」的现状及未来发展的方向性问题，大家在一些方面有所共鸣。</p> </a> </li> <li class="Sibling Sibling--next"> <a href="/posts/life-metaprogramming/" style="background-image: url('/assets/posts/20200605/banner-c425dd2a9f4c4c4b0294cbe7c6ea8ff3f93bd791e4d6e5c52b47bfaacf6f317e.jpg');"> <h3>人生元编程</h3> <p>看到文章的标题，你也许会问：什么是「元编程」？它跟人生有什么关系？</p> </a> </li> </ul> </nav> <!-- 评论区 --> <div class="Article-comments col-md-9"> <div id="disqus_thread"></div> <script type="text/javascript" src="/assets/disqusjs.min-4aa6c162858d0f13ecf2af9524ee286e764a5989b6c891b736e5a70e0a520522.js"></script> <script> var dsqjs = new DisqusJS({ shortname: 'ourairyu', siteName: '欧雷流', identifier: '/posts/model-driven-frontend-web-development/', url: 'http://' + location.host + '/posts/model-driven-frontend-web-development/', title: '我来聊聊模型驱动的前端开发', api: 'https://disqus.skk.moe/disqus/', apikey: 'Ht1OT36NinKAkkNd2l0goxrLqXDGMg1zJKWx7309PWDunyGh6jbjRt3JUmvgHSIn', admin: 'ourai', adminLabel: '鹳狸猿' }); </script> </div> </article> </div> </main> <footer class="Page-footer Footer"> <div class="container"> <div class="Footer-description"> <!-- 重要链接 --> <nav class="Footer-navs"> <ul> <li><a href="https://meta.ourai.ws/?utm_source=ourai.ws&utm_medium=common-footer" title="访问「欧雷宇宙」" target="_blank" rel="external nofollow"><span>@</span></a></li> <li><a href="/about/"><span>关于</span></a></li> <li><a href="/sponsor/"><span>赞助</span></a></li> <li><a href="/topics/"><span>专题</span></a></li> <li><a href="/projects/"><span>计划</span></a></li> <li><a href="/thanks/"><span>致谢</span></a></li> <li><a href="https://yaol.in/cooperation/?utm_source=ourai.ws&utm_medium=common-footer" target="_blank" rel="external nofollow"><span>合作</span></a></li> </ul> </nav> <!-- 网站版权 --> <div class="Footer-copyright"> <p>&copy; 2009-2025 <a href="/">欧雷流</a> 版权所有</p> <p>采用 <a href="http://jekyllrb.com" target="_blank" rel="external nofollow">Jekyll</a> 生成 ♥ 版本为 <span title="构建于 2025-02-12 03:44">v3046f1b</span></p> </div> <div class="Footer-licenses"> <p><a href="http://beian.miit.gov.cn" target="_blank" rel="external nofollow">浙ICP备16006930号-1</a></p> <p><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602005556" target="_blank" rel="external nofollow">浙公网安备 33010602005556号</a></p> </div> <!-- 社交网站 --> <div class="Footer-links hidden-xs"> <ul> <li class="Icon Icon--email"><a href="mailto:ourairyu@gmail.com" title="发送邮件给我" target="_blank" rel="external nofollow">ourairyu@gmail.com</a></li> <li class="Icon Icon--gh"><a href="https://github.com/ourai" title="查看我的全部开源项目" target="_blank" rel="external nofollow">GitHub</a></li> <li class="Icon Icon--zh"><a href="https://www.zhihu.com/people/ourai" target="_blank" rel="external nofollow">知乎</a></li> </ul> </div> </div> </div> </footer> <script type="text/javascript" src="/assets/share.min-3155ee636b84a04d036e0f1ba833227d3fd03a4c58a6f2e21c9ceb1c5d0198c7.js"></script><script type="text/javascript" src="/assets/components-a266f21fe1dfd61bebf40e74872cbf901eb3e201f7d33e9e5d5af9a55f4b24ea.js"></script> <script type="text/javascript" src="/assets/initializers/time-8d7a529a66ae6cb53c2283d21fd6a12c538b8473dd5bd76458366d09adce7bf6.js"></script><script type="text/javascript" src="/assets/initializers/lazyload-44b7df8a9282d598284d522e64d6be9ac88d466f3c4a734a514303e99347b2c9.js"></script> </body> </html>
